# 기말고사 프로젝트
본 기말고사 프로젝트에서는 KRX 시장 데이터를 활용한 “Joint Extreme Alert Bot”을 구현하였다. pykrx 라이브러리로 종목별 일별 등락률을 수집·전처리하고, 과거 수익률 분포의 하위 분위수를 임계치로 설정하여 실시간 위험을 감지하는 시스템을 완성하였다.

# 동기
증권시장에서는 종종 여러 종목이 동시에 극단적으로 하락하는 현상이 발생하며, 일반적인 투자자는 해당 리스크를 사전에 파악하기 어려운 경우가 있다. 따라서 과거 데이터 기반으로 동시 극단 하락 상황을 자동으로 감지하여 메일을 보내어 위험을 방지하는 프로그램을 고안하였다.

# 데이터 획득 방법
pykrx 라이브러리를 활용하여 KOSPI·KOSDAQ 종목의 일별 OHLCV 또는 ‘등락률’ 컬럼을 수집하였다. 컬럼명이 문자열이 아닐 경우에도 안전하게 처리하도록 방어 코드를 추가하였으며, 주말·공휴일엔 가장 최근 거래일로 자동 조정하도록 구현하였다.

# 모델
우선 load_returns() 함수를 통해 사용자가 지정한 종목들의 과거 일별 수익률 데이터를 안정적으로 수집·전처리하였다. 여기서 ‘등락률’ 컬럼이 존재하면 이를, 그렇지 않으면 ‘종가’ 기반의 pct_change() 결과를 활용하여 DataFrame을 구성하였으며, 각 종목별로 결측치를 제거하여 깨끗한 시계열 수익률 데이터를 확보하였다.

이후 compute_thresholds()를 호출하여, 과거 수익률 분포에서 사용자가 선택한 분위수(quantile)에 해당하는 하위 임계치(threshold)를 종목별로 계산하였다. 예컨대 quantile=0.05로 설정하면 각 종목의 하위 5% 수익률 값이 임계치가 되며, 이 값 이하로 수익률이 떨어지는 날을 극단 하락으로 간주하였다.

실시간 감지를 위해 get_last_trading_date()로 주말이나 휴장일을 건너뛰어 가장 최근 거래일을 파악한 뒤, 다시 load_returns()로 해당 거래일 수익률을 가져왔다. 이 수익률을 detect_joint_extreme() 함수에 넘겨 “모니터링 대상 모든 종목이 동시에 과거 하위 임계치 이하로 떨어졌는가”를 논리 연산으로 확인하였고, 이 함수가 True를 반환하면 즉시 send_email()을 호출하여 미리 설정된 발신자·수신자 이메일로 경고 메시지를 전송하였다.

send_email 함수에서는 메시지의 Subject, From, To 헤더를 각각 설정하였다. smtplib.SMTP로 smtp.gmail.com 서버에 접속한다. starttls() 메서드로 TLS 보안 채널을 시작하고 login() 메서드로 발신자 계정과 앱 비밀번호를 인증하고 send_message() 메서드로 이메일 메시지를 전송하였다. quit() 메서드로 SMTP 세션을 종료하여 연결을 닫았다.

여기에 더해 was_sent()와 mark_sent() 로직을 통해 sent_dates.txt 파일에 발송 날짜를 기록·확인하도록 구현하였다. 알림을 보낼 때마다 해당 날짜(YYYYMMDD)를 파일에 남기고, 다음 실행 시 해당 날짜가 이미 존재하면 중복 발송을 건너뛰어 불필요한 중복 알림을 방지하였다.

이 같은 흐름을 통해 과거 통계 기반 리스크 임계치를 자동으로 계산·감지하고, 실제 운영 환경에서 “동일 조건 중복 발송” 문제 없이 최초 한 번만 알림을 보내는 완성도 높은 위험 감지 시스템을 구현할 수 있었다.

# 퍼포먼스
Quantile을 1로 설정하고 변동성이 큰 KOSDAQ 중소형주(예: 펄어비스)를 모니터링한 결과, 경고가 발생하였다. 이 시스템은 단일 룰 기반 모델임에도 불구하고, 분위수 파라미터 조정만으로 알림 빈도와 민감도를 쉽게 제어할 수 있음을 확인하였다.
![image](https://github.com/user-attachments/assets/f2953bb3-11f1-40b4-ab5b-adc6f5b3d595)

![image](https://github.com/user-attachments/assets/b569d48b-e805-446d-9c6a-e1854dc90410)

# 소감 작성  
이번 프로젝트를 통해 금융수학 이론과 파이썬 라이브러리(pykrx, smtplib)를 연계하여 학습할 수 있었다. 특히 데이터 전처리, 예외 처리, 이메일 알림 통합 과정을 직접 구현하면서 실용적인 애플리케이션 개발을 해보는 좋은 경험이 되었다. 앞으로 이 기능을 더 발전시켜서 실전에서도 활용해보는 방안을 만들고 싶다는 생각이 들었다.
